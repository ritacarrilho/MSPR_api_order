## Kawa Orders API 
![](/assets/payetonkawaBanner.png)

## Participants üë•
- BILLARD M√©lissa
- BRACCIALES-COMBAS Lola
- CARRILHO LAMEIRA Rita
- DIAGNE Sokhna

## Technologie 
- Api en [FastApi](https://fastapi.tiangolo.com/)

## Base de donn√©es
[MySQL](https://www.mysql.com/fr/)

**Nom BDD** : ``order_db``

### Cr√©ation de la base de donn√©e
```python
## De la racine 
py database/scripts/create_BDD.py
```
![](/assets/create_bdd-2.png)

### Mock initial
```
https://615f5fb4f7254d0017068109.mockapi.io/api/v1/orders
```
*Liste de donn√©es de toutes les commandes*

![](/assets/mock.png)

### Mod√®le Conceptuel de Donn√©es (MCD)
![](/assets/mcd-2.png)

#### Mod√®le Logique de Donn√©es (MLD)
![](/assets/mld-2.png)

### D√©tails tables

#### Table ``orders``

id_order (INT, cl√© primaire) : Identifiant unique pour chaque commande. 

customerId (INT) : Identifiant du client qui a pass√© la commande. 

*Ce champ fait r√©f√©rence √† l'ID du client dans le microservice de gestion des clients. Il permet d'associer chaque commande √† un client sp√©cifique.*

createdAt (TIMESTAMP) : Date et heure de cr√©ation de la commande. 

#### Table ``order_products``

id_order_products (INT, cl√© primaire) : Identifiant unique de l'entr√©e de produit dans la commande.

orderId (INT) : Identifiant de la commande √† laquelle ce produit est associ√©. 

*Ce champ fait r√©f√©rence √† l'ID de la commande dans la table orders, permettant de lier chaque produit √† sa commande correspondante.*

productId (INT) : Identifiant du produit command√©. 

*Ce champ fait r√©f√©rence √† l'ID du produit dans le microservice de gestion des produits. Il permet d'associer chaque produit √† sa description et ses d√©tails dans le microservice appropri√©.*

quantity (INT) : Quantit√© de ce produit dans la commande. 

*Ce champ indique combien d'unit√©s du produit ont √©t√© command√©es, essentiel pour la gestion des stocks et le traitement des commandes.*

## Endpoints de l'API
![](/assets/api-endpoint.png)


## Docker

1) Build container : ```docker-compose build```

2) Test avec coverage : ```docker-compose up```


## Commandes utiles

### Lancer l'api en local
```python
# Dans le fichier app
fastapi dev main.py
# ou
# √Ä la racine
 uvicorn app.main:app --reload
```

### Effacer fichiers DS_Store
```java
find . -name .DS_Store -print0 | xargs -0 git rm -f --ignore-unmatch
```

## Tests
Librairie utilis√© : [unittest](https://docs.python.org/3/library/unittest.html)
```python
pip install fastapi requests sqlalchemy
```

Ex√©cuter les tests : 
```python
python -m unittest tests/test_api.py
```
### Tests unitaires et d'int√©gration

![](/assets/test-ok.png)

| Test | Description | Type de Test |
|------|-------------|--------------|
| `test_database_connection` | Teste la connexion √† la base de donn√©es. | Unitaire |
| `test_table_orders_exists` | V√©rifie que la table 'orders' existe dans `test_db`. | Unitaire |
| `test_table_order_products_exists` | V√©rifie que la table 'order_products' existe dans `test_db`. | Unitaire |
| `test_insert_into_orders` | Teste l'insertion d'une commande dans la table 'orders'. | Int√©gration |
| `test_insert_into_order_products` | Teste l'insertion d'un produit dans la table 'order_products'. | Int√©gration |
| `test_read_from_orders` | Teste la lecture des donn√©es ins√©r√©es dans la table 'orders'. | Int√©gration |
| `test_update_orders` | Teste la mise √† jour d'une commande dans la table 'orders'. | Int√©gration |
| `test_delete_from_orders` | Teste la suppression d'une commande dans la table 'orders'. | Int√©gration |
| `test_read_from_order_products` | Teste la lecture des donn√©es ins√©r√©es dans la table 'order_products'. | Int√©gration |

#### Rapport de test en format XML
```python
pytest --junitxml=report.xml
```
#### Rapport de test en format HTML
```python
coverage run -m unittest discover
coverage report
coverage html
```
![](/assets/coverage.png)
